!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("react")):"function"==typeof define&&define.amd?define(["exports","react"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).ReactIntentEngine={},e.React)}(this,function(e,t){"use strict";function n(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var r=n(t);function o(e,t,n){return{get:function(t){return t.split(".").reduce(function(e,t){return null==e?void 0:e[t]},e.getState())},set:function(t,n){e.setState(function(e){for(var r,o=structuredClone(e),u=t.split("."),i=o,a=0;a<u.length-1;a++)i=i[r=u[a]]||(i[r]={});return i[u.at(-1)]=n,o})},emit:t,effects:n}}function u(e,t,n,r){return new(n||(n=Promise))(function(o,u){function i(e){try{c(r.next(e))}catch(e){u(e)}}function a(e){try{c(r.throw(e))}catch(e){u(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(i,a)}c((r=r.apply(e,t||[])).next())})}function i(e,t){var n,r,o,u={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=a(0),i.throw=a(1),i.return=a(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(a){return function(c){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,a[0]&&(u=0)),u;)try{if(n=1,r&&(o=2&a[0]?r.return:a[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,a[1])).done)return o;switch(r=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return u.label++,{value:a[1],done:!1};case 5:u.label++,r=a[1],a=[0];continue;case 7:a=u.ops.pop(),u.trys.pop();continue;default:if(!(o=u.trys,(o=o.length>0&&o[o.length-1])||6!==a[0]&&2!==a[0])){u=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){u.label=a[1];break}if(6===a[0]&&u.label<o[1]){u.label=o[1],o=a;break}if(o&&u.label<o[2]){u.label=o[2],u.ops.push(a);break}o[2]&&u.ops.pop(),u.trys.pop();continue}a=t.call(e,u)}catch(e){a=[6,e],r=0}finally{n=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,c])}}}function a(e,t,n){if(n||2===arguments.length)for(var r,o=0,u=t.length;o<u;o++)!r&&o in t||(r||(r=Array.prototype.slice.call(t,0,o)),r[o]=t[o]);return e.concat(r||Array.prototype.slice.call(t))}function c(e){var t=structuredClone(e),n=new Set;return{getState:function(){return t},setState:function(e){t=e(t),n.forEach(function(e){return e()})},subscribe:function(e){return n.add(e),function(){return n.delete(e)}}}}function s(e){return function(t,n){var r=-1;return function o(a){return u(this,void 0,void 0,function(){var u;return i(this,function(i){if(a<=r)throw new Error("next() called twice");return r=a,(u=e[a])?[2,u(t,function(){return o(a+1)})]:[2,n()]})})}(0)}}"function"==typeof SuppressedError&&SuppressedError;var f=t.createContext(null);function l(){var e=t.useContext(f);if(!e)throw new Error("Missing IntentProvider");return e}function d(e){var t={exports:{}};return e(t,t.exports),t.exports}var p="function"==typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t},v=r.default.useState,y=r.default.useEffect,S=r.default.useLayoutEffect,h=r.default.useDebugValue;function _(e){var t=e.getSnapshot;e=e.value;try{var n=t();return!p(e,n)}catch(e){return!0}}var E="undefined"==typeof window||void 0===window.document||void 0===window.document.createElement?function(e,t){return t()}:function(e,t){var n=t(),r=v({inst:{value:n,getSnapshot:t}}),o=r[0].inst,u=r[1];return S(function(){o.value=n,o.getSnapshot=t,_(o)&&u({inst:o})},[e,n,t]),y(function(){return _(o)&&u({inst:o}),e(function(){_(o)&&u({inst:o})})},[e]),h(n),n},g={useSyncExternalStore:void 0!==r.default.useSyncExternalStore?r.default.useSyncExternalStore:E},O=d(function(e,t){"production"!==process.env.NODE_ENV&&function(){function e(e){var t=e.getSnapshot;e=e.value;try{var n=t();return!o(e,n)}catch(e){return!0}}"undefined"!=typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStart&&__REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStart(Error());var n=r.default,o="function"==typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t},u=n.useState,i=n.useEffect,a=n.useLayoutEffect,c=n.useDebugValue,s=!1,f=!1,l="undefined"==typeof window||void 0===window.document||void 0===window.document.createElement?function(e,t){return t()}:function(t,r){s||void 0===n.startTransition||(s=!0,console.error("You are using an outdated, pre-release alpha of React 18 that does not support useSyncExternalStore. The use-sync-external-store shim will not work correctly. Upgrade to a newer pre-release."));var l=r();if(!f){var d=r();o(l,d)||(console.error("The result of getSnapshot should be cached to avoid an infinite loop"),f=!0)}var p=(d=u({inst:{value:l,getSnapshot:r}}))[0].inst,v=d[1];return a(function(){p.value=l,p.getSnapshot=r,e(p)&&v({inst:p})},[t,l,r]),i(function(){return e(p)&&v({inst:p}),t(function(){e(p)&&v({inst:p})})},[t]),c(l),l};t.useSyncExternalStore=void 0!==n.useSyncExternalStore?n.useSyncExternalStore:l,"undefined"!=typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStop&&__REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStop(Error())}()}),b=d(function(e){"production"===process.env.NODE_ENV?e.exports=g:e.exports=O});e.IntentProvider=function(e){var t=e.engine,n=e.children;return r.default.createElement(f.Provider,{value:t},n)},e.composeMiddleware=s,e.createContext=o,e.createIntentEngine=function(e){var t,n,r=c(e.initialState),f=null!==(t=e.effects)&&void 0!==t?t:{},l=new Map,d=new Map,p=new Map,v=s(null!==(n=e.middleware)&&void 0!==n?n:[]);return{emit:function e(t){var n;return u(this,void 0,void 0,function(){var a,c=this;return i(this,function(s){switch(s.label){case 0:return a=o(r,e,f),(null===(n=d.get(t.type))||void 0===n?void 0:n.some(function(e){return!e(a)}))?[2]:(p.set(t.type,"pending"),[4,v(t,function(){return u(c,void 0,void 0,function(){var e,n,r;return i(this,function(o){switch(o.label){case 0:e=0,n=null!==(r=l.get(t.type))&&void 0!==r?r:[],o.label=1;case 1:return e<n.length?[4,(0,n[e])(t,a)]:[3,4];case 2:o.sent(),o.label=3;case 3:return e++,[3,1];case 4:return[2]}})})})]);case 1:return s.sent(),p.set(t.type,"success"),[2]}})})},on:function(e,t){var n;l.set(e,a(a([],null!==(n=l.get(e))&&void 0!==n?n:[],!0),[t],!1))},guard:function(e,t){var n;d.set(e,a(a([],null!==(n=d.get(e))&&void 0!==n?n:[],!0),[t],!1))},store:r,getStatus:function(e){var t;return null!==(t=p.get(e))&&void 0!==t?t:"idle"}}},e.createStore=c,e.useEngine=l,e.useIntent=function(){var e=l();return function(t){return e.emit(t)}},e.useIntentState=function(e){var n=l(),r=t.useRef();return b.useSyncExternalStore(n.store.subscribe,function(){var t=e(n.store.getState());return Object.is(t,r.current)?r.current:(r.current=t,t)})},e.useIntentStatus=function(e){var t=l();return b.useSyncExternalStore(function(n){return t.subscribeStatus(e,n)},function(){return t.getStatus(e)})},Object.defineProperty(e,"__esModule",{value:!0})});
