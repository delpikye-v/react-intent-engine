import t,{createContext as e,useContext as n,useRef as r}from"react";function o(t,e,n){return{get:function(e){return e.split(".").reduce(function(t,e){return null==t?void 0:t[e]},t.getState())},set:function(e,n){t.setState(function(t){for(var r,o=structuredClone(t),u=e.split("."),i=o,c=0;c<u.length-1;c++)i=i[r=u[c]]||(i[r]={});return i[u.at(-1)]=n,o})},emit:e,effects:n}}function u(t,e,n,r){return new(n||(n=Promise))(function(o,u){function i(t){try{a(r.next(t))}catch(t){u(t)}}function c(t){try{a(r.throw(t))}catch(t){u(t)}}function a(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n(function(t){t(e)})).then(i,c)}a((r=r.apply(t,e||[])).next())})}function i(t,e){var n,r,o,u={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=c(0),i.throw=c(1),i.return=c(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(c){return function(a){return function(c){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,c[0]&&(u=0)),u;)try{if(n=1,r&&(o=2&c[0]?r.return:c[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,c[1])).done)return o;switch(r=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return u.label++,{value:c[1],done:!1};case 5:u.label++,r=c[1],c=[0];continue;case 7:c=u.ops.pop(),u.trys.pop();continue;default:if(!(o=u.trys,(o=o.length>0&&o[o.length-1])||6!==c[0]&&2!==c[0])){u=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){u.label=c[1];break}if(6===c[0]&&u.label<o[1]){u.label=o[1],o=c;break}if(o&&u.label<o[2]){u.label=o[2],u.ops.push(c);break}o[2]&&u.ops.pop(),u.trys.pop();continue}c=e.call(t,u)}catch(t){c=[6,t],r=0}finally{n=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,a])}}}function c(t,e,n){if(n||2===arguments.length)for(var r,o=0,u=e.length;o<u;o++)!r&&o in e||(r||(r=Array.prototype.slice.call(e,0,o)),r[o]=e[o]);return t.concat(r||Array.prototype.slice.call(e))}function a(t){var e=structuredClone(t),n=new Set;return{getState:function(){return e},setState:function(t){e=t(e),n.forEach(function(t){return t()})},subscribe:function(t){return n.add(t),function(){return n.delete(t)}}}}function s(t){return function(e,n){var r=-1;return function o(c){return u(this,void 0,void 0,function(){var u;return i(this,function(i){if(c<=r)throw new Error("next() called twice");return r=c,(u=t[c])?[2,u(e,function(){return o(c+1)})]:[2,n()]})})}(0)}}function f(t){var e,n,r=a(t.initialState),f=null!==(e=t.effects)&&void 0!==e?e:{},l=new Map,d=new Map,p=new Map,v=s(null!==(n=t.middleware)&&void 0!==n?n:[]);return{emit:function t(e){var n;return u(this,void 0,void 0,function(){var c,a=this;return i(this,function(s){switch(s.label){case 0:return c=o(r,t,f),(null===(n=d.get(e.type))||void 0===n?void 0:n.some(function(t){return!t(c)}))?[2]:(p.set(e.type,"pending"),[4,v(e,function(){return u(a,void 0,void 0,function(){var t,n,r;return i(this,function(o){switch(o.label){case 0:t=0,n=null!==(r=l.get(e.type))&&void 0!==r?r:[],o.label=1;case 1:return t<n.length?[4,(0,n[t])(e,c)]:[3,4];case 2:o.sent(),o.label=3;case 3:return t++,[3,1];case 4:return[2]}})})})]);case 1:return s.sent(),p.set(e.type,"success"),[2]}})})},on:function(t,e){var n;l.set(t,c(c([],null!==(n=l.get(t))&&void 0!==n?n:[],!0),[e],!1))},guard:function(t,e){var n;d.set(t,c(c([],null!==(n=d.get(t))&&void 0!==n?n:[],!0),[e],!1))},store:r,getStatus:function(t){var e;return null!==(e=p.get(t))&&void 0!==e?e:"idle"}}}"function"==typeof SuppressedError&&SuppressedError;var l=e(null);function d(e){var n=e.engine,r=e.children;return t.createElement(l.Provider,{value:n},r)}function p(){var t=n(l);if(!t)throw new Error("Missing IntentProvider");return t}function v(){var t=p();return function(e){return t.emit(e)}}function S(t){var e={exports:{}};return t(e,e.exports),e.exports}var y="function"==typeof Object.is?Object.is:function(t,e){return t===e&&(0!==t||1/t==1/e)||t!=t&&e!=e},h=t.useState,_=t.useEffect,E=t.useLayoutEffect,O=t.useDebugValue;function g(t){var e=t.getSnapshot;t=t.value;try{var n=e();return!y(t,n)}catch(t){return!0}}var w="undefined"==typeof window||void 0===window.document||void 0===window.document.createElement?function(t,e){return e()}:function(t,e){var n=e(),r=h({inst:{value:n,getSnapshot:e}}),o=r[0].inst,u=r[1];return E(function(){o.value=n,o.getSnapshot=e,g(o)&&u({inst:o})},[t,n,e]),_(function(){return g(o)&&u({inst:o}),t(function(){g(o)&&u({inst:o})})},[t]),O(n),n},b={useSyncExternalStore:void 0!==t.useSyncExternalStore?t.useSyncExternalStore:w},x=S(function(e,n){"production"!==process.env.NODE_ENV&&function(){function e(t){var e=t.getSnapshot;t=t.value;try{var n=e();return!o(t,n)}catch(t){return!0}}"undefined"!=typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStart&&__REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStart(Error());var r=t,o="function"==typeof Object.is?Object.is:function(t,e){return t===e&&(0!==t||1/t==1/e)||t!=t&&e!=e},u=r.useState,i=r.useEffect,c=r.useLayoutEffect,a=r.useDebugValue,s=!1,f=!1,l="undefined"==typeof window||void 0===window.document||void 0===window.document.createElement?function(t,e){return e()}:function(t,n){s||void 0===r.startTransition||(s=!0,console.error("You are using an outdated, pre-release alpha of React 18 that does not support useSyncExternalStore. The use-sync-external-store shim will not work correctly. Upgrade to a newer pre-release."));var l=n();if(!f){var d=n();o(l,d)||(console.error("The result of getSnapshot should be cached to avoid an infinite loop"),f=!0)}var p=(d=u({inst:{value:l,getSnapshot:n}}))[0].inst,v=d[1];return c(function(){p.value=l,p.getSnapshot=n,e(p)&&v({inst:p})},[t,l,n]),i(function(){return e(p)&&v({inst:p}),t(function(){e(p)&&v({inst:p})})},[t]),a(l),l};n.useSyncExternalStore=void 0!==r.useSyncExternalStore?r.useSyncExternalStore:l,"undefined"!=typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStop&&__REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStop(Error())}()}),L=S(function(t){"production"===process.env.NODE_ENV?t.exports=b:t.exports=x});function m(t){var e=p(),n=r();return L.useSyncExternalStore(e.store.subscribe,function(){var r=t(e.store.getState());return Object.is(r,n.current)?n.current:(n.current=r,r)})}function T(t){var e=p();return L.useSyncExternalStore(function(n){return e.subscribeStatus(t,n)},function(){return e.getStatus(t)})}export{d as IntentProvider,s as composeMiddleware,o as createContext,f as createIntentEngine,a as createStore,p as useEngine,v as useIntent,m as useIntentState,T as useIntentStatus};
